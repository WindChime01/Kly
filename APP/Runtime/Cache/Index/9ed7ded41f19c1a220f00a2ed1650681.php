<?php if (!defined('THINK_PATH')) exit();?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <meta name="robots" content="noindex,nofollow">    <meta name="robots" content="noarchive">    <!-- 屏蔽-->    <title>签署协议</title>    <meta name="keywords" content=" ">    <meta name="viewport" content="initial-scale=1, maximum-scale=1">    <meta name="apple-mobile-web-app-capable" content="yes">    <meta name="apple-mobile-web-app-status-bar-style" content="black">    <meta content="IE=9; IE=EDGE" http-equiv="X-UA-Compatible">    <link rel="stylesheet" href="/Public/ybt/css/sm.css">    <script src="/Public/ybt/js/jquery-3.3.1/jquery-3.3.1.min.js"></script>    <link rel="stylesheet" href="/Public/ybt/css/sm-extend.css">    <link rel="stylesheet" href="/Public/ybt/css/iconfont.css">    <!--自定义-->    <link rel="stylesheet" href="/Public/ybt/css/main.css">    <link rel="stylesheet" href="/Public/ybt/css/order.css">    	<link rel="stylesheet" href="/Public/ybt/css/layui.css"></head><style>	.content{		height:100%;		width:100%;		padding-bottom: 0;	}		.top_bg{		background: #253057;		width:100%;		height:60px;		position: fixed;		top:0;		left:0;		opacity: 1;		z-index: 999;	}		.coin-div{		overflow: hidden;		border-radius:15px;		width:90%;		height:auto;		background: #253057;		margin:0 auto;		margin-top: 20px;		color:#fff;		position: relative;	}		.font-div{		padding:15px 20px;		position: relative;	}		.coin-type{		width:100%;		margin-bottom: 20px;	}		.coin{		font-size: 16px;		margin-bottom:15px;	}		.coin-detail{		color:#D6D6D6;		font-size: 16px;		margin-bottom:5px;		opacity:0.8;		word-wrap:break-word;	}		.arrow{		width:9px;		height:16px;		margin-left: 10px;	}		.profit{		height:25px;		line-height: 25px;		display: inline-block;		width:100%;		font-size: 14px;	}		.profit ul li{		width:50%;		display: inline-block;		float: left;		position: relative;	}	.profit ul li span{		margin-left: 25px;		opacity: 0.8;	}	.profit ul li .money{		top:50%;		margin-top: -8.5px;		width:17px;		height:17px;		left: 0;		position: absolute;	}		.right{		position: absolute;		right:20px;		top:20px;		width:60px;		height:23px;		background: url('/Public/ybt/image/center/right-icon.png');		background-size: 100% 100%;		line-height: 23px;	}		.right img{		width:12px;		height:12px;		position: absolute;		top:50%;		margin-top: -6px;		left:10px;	}		.right span{		font-size: 14px;		margin-left:30px;		opacity:0.8;	}		.top-div{		width:100%;		height:auto;		position: fixed;		top:0;		z-index: 999;		background: transparent;	}		#cancle{		position: absolute;		left:20px;		top:35%;		margin-top: -9px;		color:#fff;	}		.top-title{		padding:5px 20px;		width:100%;		line-height: 36px;		font-size: 14px;		background: #323E65;	}		.top-title .top-time{		color:#C2C7E4;		float: left;		font-size: 16px;	}		.top-title .top-tip{		color:#3A83F6;		float: right;		font-size: 17px;	}		@media screen and (min-width:320px){		.coin-detail span{			color:#4099FC;			display: block;			margin-top: 10px;		}	}		@media screen and (min-width:375px){		.coin-detail span{			color:#4099FC;			display: block;		}	}		.appeal{		line-height: 20px;		position: absolute;		right:20px;		top:50px;		background:#3A83F6;		border: none;		border-radius: 15px;		border-top-left-radius: 5px;		font-size: 15px;		padding:3px 20px;	}		/*.layui-layer{*/	/*	top:50%!important;*/	/*	left:50%!important;*/	/*	transform: translate(-50%,-50%)!important;*/	/*}*/		.layui-btn{		margin: 0 5px;	}		.layui-tab{		margin:60px 0 20px;	}		.layui-tab-title{		border:none;		width:100%;		position: fixed;		z-index:999;	}		.layui-tab-title li{		width:50%;		color:#D6D6D6;		font-size: 0.8rem;	}		.layui-tab-brief>.layui-tab-title .layui-this{		color:#fff;	}		.layui-tab-brief>.layui-tab-title .layui-this:after{		width:20px;		left:50%;		margin-left: -10px;		height:5px;		background: #fff;		border-radius: 30px;		top:unset;		bottom:0;	}		.foot-bar .foot-menu span{		padding:1px 0 0 0;	}	.showimg{		display: none;		width: 300px;		position: fixed;		top:50%;		left:50%;		z-index: 10002;		transform: translate(-50%,-50%);	}	.shade{		position: absolute;		top: 0;		left: 0;		width: 100%;		height: 2000px;		background-color:rgba(0,0,0,0.5);		display: none;		z-index: 10001;	}	.layui-tab-content{		padding:0;		position: fixed;		height: calc(100% - 60px);		width: 100%;		overflow-y: scroll;	}		.detail-title{		color:#C2C7E4;	}</style><body><!-- Main Container start --><div class="page">	<div class="content" id="main_content">		<div class="top_bg"></div>	<!-- 标题栏 -->		<div class="top-div">		<a style="width: 100%;text-align: center;display: inline-block;line-height: 60px;height:90px;font-size: 0.85rem; color:#FFF;">签署协议</a>	    <a id="cancle" href="/index/shop/orderlist"><i class="icon icon-left"></i></a>		</div>		<?php if($xieyi_id != ''): ?><div style="width:90%;margin: 70px auto;">				<input type="button" style="height:2rem;width:100%;background:#9f6063;border:none;color:white;border-radius:5px;margin:20px auto" value="您已签署协议">				<!--<a href="/index/shop/xieyi?id=<?php echo ($xieyi_id); ?>" style="display:inline-block;height:2rem;width:100%;background:#d9474d;border:none;color:white;border-radius:5px;margin:20px auto;text-align:center;line-height:2rem" order_id="<?php echo ($order_id); ?>" >下载协议</a>-->				<?php if($type == 'android'): ?><a href="<?php echo ($path); ?>" style="display:inline-block;height:2rem;width:100%;background:#d9474d;border:none;color:white;border-radius:5px;margin:20px auto;text-align:center;line-height:2rem" >下载协议</a><?php endif; ?>				<!--<a href="/index/shop/downloadXy?path=<?php echo ($path); ?>" style="display:inline-block;height:2rem;width:100%;background:#d9474d;border:none;color:white;border-radius:5px;margin:20px auto;text-align:center;line-height:2rem"  id="downloadXy">下载协议</a>-->				<a href="javascript:;" style="display:inline-block;height:2rem;width:100%;background:#d9474d;border:none;color:white;border-radius:5px;margin:20px auto;text-align:center;line-height:2rem"  onclick="sendXy('<?php echo ($path); ?>')">发送协议到邮箱</a>			</div>		<?php else: ?>		<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">		    <div style="width:100%;height:2rem;margin-top:70px;line-height:2rem;border-bottom:2px solid #ccc;color:white;font-size:0.8rem">		    	<a href="/Public/agreement/产品服务租赁协议（星际元）@0526.doc">		    	<img style="height:1rem;margin-left:1rem" src="/Public/ybt/image/agreement.png"/><span style="color:#979e9e"> 查看协议详情</span> <img style="float:right;margin-right:1rem;height:1rem;margin-top:10px" src="/Public/ybt/image/center/arrow.png"/>		    	</a>		    </div>			<div style="width:100%">				<form class="form-signin" id="agreementForm" name="agreementForm"  method="post">					<div class="list-block">						<div style="margin: 0 1rem 0 1rem">							<div class="main-box">								<div class="item-inner" style="height:70px;border-top: none">				                            <div class="item-title label" style="width:30%;color:#979e9e">甲方</div>				                            <div class="item-input">		                                <input style="color:#fff;text-align:right;font-size:0.75rem" name="jiafang" type="text" value="<?php echo ($username); ?>" placeholder="请输入甲方全称">		                            </div>				                        </div>							</div>							<div class="main-box">								<div class="item-inner" style="height:70px;border-top: none">				                            <div class="item-title label" style="width:30%;color:#979e9e">身份证/护照</div>				                            <div class="item-input">		                                <input style="color:#fff;text-align:right;font-size:0.75rem" name="idnum" type="text" placeholder="请输入身份证/护照">		                            </div>				                        </div>							</div>							<div class="main-box">								<div class="item-inner" style="height:70px;border-top: none">				                            <div class="item-title label" style="width:30%;color:#979e9e">联系地址</div>				                            <div class="item-input">		                                <input style="color:#fff;text-align:right;font-size:0.75rem" name="address" type="text" placeholder="请输入联系地址">		                            </div>				                        </div>							</div>							<div class="main-box">								<div class="item-inner" style="height:70px;border-top: none">				                            <div class="item-title label" style="width:30%;color:#979e9e">联系电话</div>				                            <div class="item-input">		                                <input style="color:#fff;text-align:right;font-size:0.75rem" name="phone" type="text" placeholder="请输入联系电话">		                            </div>				                        </div>							</div>						</div>							</div>					<div style="width:90%;margin:1rem auto;color:#979e9e">请在下方完成签名后确认</div>					<div style="width:90%;margin:auto;">						<div id="signature" style="background:white"></div>					    					    <input type="button" style="height:2rem;width:3.5rem;background:#7e7476;border:none;color:white;margin:10px 10px 10px 0;border-radius:5px" value="清除签名" id="reset"/>					    <input type="button" style="height:2rem;width:3.5rem;background:#FF6C72;border:none;color:white;margin:10px;border-radius:5px" value="确认签名" id="download"/>					    <input type="hidden" name='sign' id="sign" value="">					    <input type="hidden" name='order_id' value="<?php echo ($order_id); ?>">					    <div id="someelement" style="display:none"><img src="" id="images"></div>					</div>					<div style="width:90%;margin:auto;">						<input type="button" style="height:2rem;width:100%;background:#d9474d;border:none;color:white;border-radius:5px;margin:20px auto" value="保存" id="submit">					</div>									</form>			</div>		</div><?php endif; ?>	</div></div><script src="/Public/ybt/js/sign/jSignature/libs/jSignature.min.js"></script><!--<script type="text/javascript" src="/Public/ybt/js/jquery-3.3.1/jquery-3.3.1.js"></script>--><script type="text/javascript" src="/Public/ybt/js/layer/layer.js"></script><script>    $(function() {        var $sigdiv = $("#signature");        // $sigdiv.jSignature(); // 初始化jSignature插件-属性用","隔开        // $sigdiv.jSignature({'decor-color':'red'}); // 初始化jSignature插件-设置横线颜色        // $sigdiv.jSignature({'lineWidth':"6"});// 初始化jSignature插件-设置横线粗细        // $sigdiv.jSignature({"decor-color":"transparent"});// 初始化jSignature插件-去掉横线        // $sigdiv.jSignature({'UndoButton':true});// 初始化jSignature插件-撤销功能        $sigdiv.jSignature({'height': 180, 'width': 350}); // 初始化jSignature插件-设置书写范围(大小)        // $("#yes").click(function(){        //     //将画布内容转换为图片        //     var datapair = $sigdiv.jSignature("getData", "image");        //     $("#images").attr('src','data:' + datapair[0] + "," + datapair[1]);        // });        $("#download").click(function(){        	//将画布内容转换为图片            var datapair = $sigdiv.jSignature("getData", "image");            var img_src = 'data:' + datapair[0] + "," + datapair[1];            $("#images").attr('src',img_src);                        var src_data = img_src;            // console.log(src_data);return;            if(src_data){                $.ajax({                    type:'post',                    url:'/index/shop/saveAgreement',                    data:{src_data:src_data},                    async:false,                    success:function(data){                        $data = JSON.parse(data);                        if($data.success){                            layer.msg($data.msg);                            $("#sign").val($data.url);                            // alert('生成签名成功！');                        }else{                            layer.msg($data.msg);                        }                    }                });            }else{                layer.msg('请确认签名');return false;            }        });        $("#reset").click(function(){            $("#signature").jSignature("reset"); //重置画布，可以进行重新作画            $("#images").attr('src','');            $("#sign").val('');        });                $("#submit").click(function(){        	$data = $('#agreementForm').serialize();	        $.post('/Index/shop/agreementHandel',$data,function (response) {	            $data = JSON.parse(response);	            if ($data.success == 0) {	                //弹出错误提示	                layer.msg($data.msg);	            } else if ($data.success == 1) {	            	// window.location.href = '/index/shop/xieyi?id=' + $data.data;	                layer.msg($data.msg);					setTimeout(function(){						window.location.href = '/index/shop/xieyi?id=' + $data.data;	                    // window.location.href = '/index/shop/agreement?id=' + "<?php echo ($order_id); ?>";	                },1000);	            }	        });        });    });        //判断协议是否存在    $is_empty = "<?php echo ($empty); ?>";    if($is_empty == 1) {    	layer.msg("该订单还未生成协议，即将为您跳转生成协议页面");		setTimeout(function(){			window.location.href = '/index/shop/xieyi?id=' + "<?php echo ($xieyi_id); ?>";            // window.location.href = '/index/shop/agreement?id=' + "<?php echo ($order_id); ?>";        },2000);    }        // $is_old = "<?php echo ($is_old); ?>";    // if($is_old == 1) {    //     layer.msg("2020年7月10号之前购买的矿机如未签署协议，请联系客服签署纸质版协议！谢谢！");    // }        function sendXy($path) {    	layer.prompt({title: '请输入接收邮箱'}, function(pass, index){			if(!checkEmail(pass)){				layer.msg('请输入正确的邮箱！');				return;			}			layer.close(index);			var index = layer.load(1, {			  shade: [0.5,'#000'] //0.1透明度的白色背景			});			$.post('/index/sem/sendXy',{path:$path,email:pass},function(response){				layer.close(index);    			$data = JSON.parse(response);    			layer.msg($data.msg);    		});		});    		    }        function checkEmail(email) {    	var reg = /^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/;    	if (reg.test(email)) {            return true;        }else{            return false;        };    }</script></body></html>