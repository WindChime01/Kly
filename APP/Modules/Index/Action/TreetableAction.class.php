<?php  header("Content-type:text/html;charset=utf-8");/** * 会员推广控制器 */Class TreetableAction extends Action{	public function index(){		$list = M('member')->order('id asc')->field('id,username,level,parent_id as pid')->select();		foreach($list as &$val) {			$val_count = $this->m_GetTeamMember($list, $val['id']);	        $val['nums'] = count($val_count);	        $val['level'] = M('team_level_group')->where(["level"=>$val['level']])->getField("name");			if($val['pid'] == 0) {				$val['pid'] = -1;			}		}		$res = array('code'=>"0",'msg'=>'ok','data'=>$list);		$json = json_encode($res);		$myfile = fopen("./Public/ybt/plugin/TreeTable/json/data.json", "w") or die("Unable to open file!");		fwrite($myfile, $json);		$this->display();	}		public function index2(){		$list = M('member')->order('id asc')->field('id,username,level,parent_id as pid')->select();		foreach($list as &$val) {			$val_count = $this->m_GetTeamMember($list, $val['id']);	        $val['nums'] = count($val_count);	        $val['level'] = M('team_level_group')->where(["level"=>$val['level']])->getField("name");		}		$res = array('code'=>"0",'msg'=>'ok','data'=>$list);		$json = json_encode($res);		$myfile = fopen("./Public/ybt/plugin/TreeTable/json/data.json", "w") or die("Unable to open file!");		fwrite($myfile, $json);		$this->display('test5');	}	// 无限下级    public function m_GetTeamMember($members, $mid)    {        $Teams = array(); //最终结果        $Teams[] = $mid;        $array = array();        foreach ($members as $k => $v) {            if (in_array($v['pid'], $Teams, true)) {                $Teams[] = $v['id'];                $array[] = $v;                unset($members[$k]);            } else {                unset($members[$k]);            }        }        return $array;    }}?>